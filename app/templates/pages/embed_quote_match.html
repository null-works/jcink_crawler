{% extends "pages/game_base.html" %}
{% block title %}Quote Match{% endblock %}
{% block heading %}Quote Match{% endblock %}
{% block subheading %}Same character or different?{% endblock %}
{% block game_script %}
<script>
(function() {
    function loadRound() {
        _locked = false;
        $area.innerHTML = '<div class="loading">Loading</div>';
        apiFetch('/api/game/quote-match').then(function(data) {
            var html = '<div class="quote-card"><div class="quote-label">Quote A</div>';
            html += '<div class="quote-text">' + esc(data.quote_a) + '</div></div>';
            html += '<div class="vs-divider">vs</div>';
            html += '<div class="quote-card"><div class="quote-label">Quote B</div>';
            html += '<div class="quote-text">' + esc(data.quote_b) + '</div></div>';
            html += '<div class="binary-options">';
            html += '<button class="binary-btn" data-guess="same">Same Character</button>';
            html += '<button class="binary-btn" data-guess="different">Different</button>';
            html += '</div>';
            html += '<div class="result-msg" id="result-msg"></div>';
            html += '<button class="next-btn" id="next-btn">Next Round</button>';
            $area.innerHTML = html;

            $area.querySelectorAll('.binary-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    if (_locked) return;
                    var guessedSame = btn.dataset.guess === 'same';
                    var correct = guessedSame === data.same_character;
                    var reveal = data.same_character
                        ? 'Both by ' + data.character_a
                        : data.character_a + ' & ' + data.character_b;
                    $area.querySelectorAll('.binary-btn').forEach(function(b) {
                        b.classList.add('locked');
                        var isSameBtn = b.dataset.guess === 'same';
                        if (isSameBtn === data.same_character) b.classList.add('correct');
                        else if (b === btn && !correct) b.classList.add('wrong');
                    });
                    var msg = document.getElementById('result-msg');
                    msg.innerHTML = (correct ? 'Correct! ' : 'Wrong! ') + esc(reveal);
                    msg.className = 'result-msg ' + (correct ? 'correct' : 'wrong');
                    showResult(correct);
                });
            });
            document.getElementById('next-btn').addEventListener('click', loadRound);
        }).catch(function() {
            $area.innerHTML = '<div class="loading" style="color:var(--red)">Could not load round. Need at least 2 characters with quotes.</div>';
        });
    }
    loadRound();
})();
</script>
{% endblock %}
