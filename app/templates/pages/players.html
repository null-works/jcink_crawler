{% extends "base.html" %}
{% block title %}Players - The Watcher{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Players</h1>
    <p class="subtitle">{{ stats.total_players }} writers tracked across {{ stats.characters_tracked }} characters</p>
</div>

{# Filters #}
<div class="filters-bar">
    <input type="search" name="q" class="search-input" placeholder="Search players..."
           value="{{ q or '' }}"
           hx-get="/htmx/players"
           hx-trigger="keyup changed delay:300ms"
           hx-target="#player-tbody"
           hx-include=".player-filter">

    <input type="hidden" name="sort" value="{{ sort or 'player' }}" class="player-filter">
    <input type="hidden" name="dir" value="{{ dir or 'asc' }}" class="player-filter">
</div>

{# Player table #}
<div class="table-wrap">
<table class="data-table">
    <thead>
        <tr>
            <th class="sortable {{ 'sort-asc' if sort == 'player' and dir == 'asc' }}{{ 'sort-desc' if sort == 'player' and dir == 'desc' }}"
                hx-get="/htmx/players?sort=player&dir={{ 'desc' if sort == 'player' and dir == 'asc' else 'asc' }}"
                hx-target="#player-tbody" hx-include="[name='q']">Player</th>
            <th class="sortable {{ 'sort-asc' if sort == 'character_count' and dir == 'asc' }}{{ 'sort-desc' if sort == 'character_count' and dir == 'desc' }}"
                hx-get="/htmx/players?sort=character_count&dir={{ 'desc' if sort == 'character_count' and dir == 'asc' else 'asc' }}"
                hx-target="#player-tbody" hx-include="[name='q']">Characters</th>
            <th>Roster</th>
            <th class="sortable {{ 'sort-asc' if sort == 'total_threads' and dir == 'asc' }}{{ 'sort-desc' if sort == 'total_threads' and dir == 'desc' }}"
                hx-get="/htmx/players?sort=total_threads&dir={{ 'desc' if sort == 'total_threads' and dir == 'asc' else 'asc' }}"
                hx-target="#player-tbody" hx-include="[name='q']">Threads</th>
            <th class="sortable {{ 'sort-asc' if sort == 'awaiting_threads' and dir == 'asc' }}{{ 'sort-desc' if sort == 'awaiting_threads' and dir == 'desc' }}"
                hx-get="/htmx/players?sort=awaiting_threads&dir={{ 'desc' if sort == 'awaiting_threads' and dir == 'asc' else 'asc' }}"
                hx-target="#player-tbody" hx-include="[name='q']">Awaiting</th>
            <th class="sortable hide-mobile {{ 'sort-asc' if sort == 'last_active' and dir == 'asc' }}{{ 'sort-desc' if sort == 'last_active' and dir == 'desc' }}"
                hx-get="/htmx/players?sort=last_active&dir={{ 'desc' if sort == 'last_active' and dir == 'asc' else 'asc' }}"
                hx-target="#player-tbody" hx-include="[name='q']">Last Active</th>
        </tr>
    </thead>
    <tbody id="player-tbody">
        {% include "partials/player_table_rows.html" %}
    </tbody>
</table>
</div>
{% endblock %}
