<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}Quote Game{% endblock %} â€” The Watcher</title>
<style>
:root {
    --bg: #282a36; --bg-darker: #1e1f29; --bg-light: #2d2f3d;
    --current: #44475a; --fg: #f8f8f2; --comment: #6272a4;
    --cyan: #8be9fd; --green: #50fa7b; --orange: #ffb86c;
    --pink: #ff79c6; --purple: #bd93f9; --red: #ff5555; --yellow: #f1fa8c;
    --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    --radius: 6px; --radius-lg: 10px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: var(--font-sans); background: var(--bg); color: var(--fg);
    line-height: 1.6; padding: 1rem; min-height: 100vh;
}
.game-container { max-width: 600px; margin: 0 auto; }
.game-header { text-align: center; margin-bottom: 1.5rem; }
.game-header h1 { font-size: 1.3rem; color: var(--purple); margin-bottom: 0.25rem; }
.game-header p { font-size: 0.85rem; color: var(--comment); }
.score-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0.5rem 0.75rem; background: var(--bg-darker); border-radius: var(--radius);
    margin-bottom: 1rem; font-size: 0.85rem;
}
.score-bar .streak { color: var(--orange); font-weight: 600; }
.score-bar .score { color: var(--green); font-weight: 600; }
.score-bar .best { color: var(--pink); }
.quote-card {
    background: var(--bg-darker); border: 1px solid var(--current); border-radius: var(--radius-lg);
    padding: 1.25rem 1.5rem; margin-bottom: 1rem; position: relative;
}
.quote-card::before {
    content: '\201C'; position: absolute; top: -0.15rem; left: 0.5rem;
    font-size: 3rem; color: var(--purple); opacity: 0.3; line-height: 1;
}
.quote-text {
    font-size: 1.05rem; font-style: italic; color: var(--fg); padding-left: 1.25rem;
}
.quote-label {
    font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;
    color: var(--comment); margin-bottom: 0.4rem; font-weight: 600;
}
.options { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; }
.option-btn {
    display: flex; align-items: center; gap: 0.75rem;
    padding: 0.65rem 1rem; border-radius: var(--radius); border: 1px solid var(--current);
    background: var(--bg-light); color: var(--fg); cursor: pointer;
    font-size: 0.9rem; font-weight: 500; transition: all 0.15s; text-align: left; width: 100%;
}
.option-btn:hover:not(.locked) { border-color: var(--purple); background: var(--current); }
.option-btn.correct { border-color: var(--green); background: rgba(80, 250, 123, 0.12); color: var(--green); }
.option-btn.wrong { border-color: var(--red); background: rgba(255, 85, 85, 0.12); color: var(--red); opacity: 0.7; }
.option-btn.locked { cursor: default; }
.option-btn .avatar {
    width: 32px; height: 32px; border-radius: 50%; object-fit: cover;
    border: 2px solid var(--current); flex-shrink: 0;
}
.option-btn.correct .avatar { border-color: var(--green); }
.option-btn.wrong .avatar { border-color: var(--red); }
.binary-options { display: flex; gap: 0.75rem; margin-bottom: 1rem; }
.binary-btn {
    flex: 1; padding: 0.75rem; border-radius: var(--radius); border: 1px solid var(--current);
    background: var(--bg-light); color: var(--fg); cursor: pointer;
    font-size: 1rem; font-weight: 600; text-align: center; transition: all 0.15s;
}
.binary-btn:hover:not(.locked) { border-color: var(--purple); }
.binary-btn.correct { border-color: var(--green); background: rgba(80, 250, 123, 0.12); color: var(--green); }
.binary-btn.wrong { border-color: var(--red); background: rgba(255, 85, 85, 0.12); color: var(--red); }
.result-msg {
    text-align: center; font-size: 0.9rem; font-weight: 600; min-height: 1.5rem;
    margin-bottom: 0.5rem; transition: opacity 0.3s;
}
.result-msg.correct { color: var(--green); }
.result-msg.wrong { color: var(--red); }
.next-btn {
    display: block; width: 100%; padding: 0.65rem; border-radius: var(--radius);
    border: none; background: var(--purple); color: var(--bg); cursor: pointer;
    font-size: 0.9rem; font-weight: 600; transition: opacity 0.2s;
}
.next-btn:hover { opacity: 0.85; }
.next-btn:disabled { opacity: 0.4; cursor: default; }
.loading { text-align: center; color: var(--comment); padding: 2rem; font-size: 0.9rem; }
.loading::after { content: '...'; animation: dots 1.2s steps(4,end) infinite; }
@keyframes dots { 0%,20%{content:''} 40%{content:'.'} 60%{content:'..'} 80%,100%{content:'...'} }
.vs-divider {
    text-align: center; font-size: 0.8rem; color: var(--comment);
    text-transform: uppercase; letter-spacing: 0.1em; margin: 0.5rem 0; font-weight: 600;
}
{% block extra_css %}{% endblock %}
@media (max-width: 480px) {
    body { padding: 0.5rem; }
    .quote-text { font-size: 0.95rem; }
}
</style>
</head>
<body>
<div class="game-container">
    <div class="game-header">
        <h1>{% block heading %}Quote Game{% endblock %}</h1>
        <p>{% block subheading %}How well do you know your characters?{% endblock %}</p>
    </div>

    <div class="score-bar">
        <span class="score">Score: <span id="score">0</span></span>
        <span class="streak">Streak: <span id="streak">0</span></span>
        <span class="best">Best: <span id="best">0</span></span>
    </div>

    <div id="game-area">
        <div class="loading">Loading</div>
    </div>
</div>

<script>
var API_BASE = window.QUOTE_GAME_API || 'https://imagehut.ch:8943';
var _score = 0, _streak = 0, _best = 0, _locked = false;
var $score = document.getElementById('score');
var $streak = document.getElementById('streak');
var $best = document.getElementById('best');
var $area = document.getElementById('game-area');

function updateScores() {
    $score.textContent = _score;
    $streak.textContent = _streak;
    if (_streak > _best) _best = _streak;
    $best.textContent = _best;
}
function showResult(correct) {
    _locked = true;
    if (correct) { _score++; _streak++; } else { _streak = 0; }
    updateScores();
}
function apiFetch(path) {
    return fetch(API_BASE + path).then(function(r) {
        if (!r.ok) throw new Error('API error');
        return r.json();
    });
}
function esc(s) {
    var d = document.createElement('div');
    d.textContent = s || '';
    return d.innerHTML;
}
function avatarTag(url) {
    if (url) return '<img class="avatar" src="' + esc(url) + '" alt="" onerror="this.style.display=\'none\'">';
    return '<span class="avatar" style="display:inline-block;background:var(--current);"></span>';
}
</script>
{% block game_script %}{% endblock %}
</body>
</html>
