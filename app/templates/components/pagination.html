{# Reusable pagination macro.
   Usage: {% from "components/pagination.html" import paginate %}
          {{ paginate(total, page, per_page, target_id, base_url, extra_params) }}
#}
{% macro paginate(total, page, per_page, target_id, base_url, extra_params="") %}
{% set total_pages = ((total + per_page - 1) // per_page) if per_page > 0 else 1 %}
{% if total_pages > 1 %}
<nav class="pagination">
    {% if page > 1 %}
    <a class="page-link" href="#"
       hx-get="{{ base_url }}?page={{ page - 1 }}{{ extra_params }}"
       hx-target="#{{ target_id }}" hx-swap="innerHTML">&laquo;</a>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
        <span class="page-link active">{{ p }}</span>
        {% elif p <= 2 or p >= total_pages - 1 or (p >= page - 2 and p <= page + 2) %}
        <a class="page-link" href="#"
           hx-get="{{ base_url }}?page={{ p }}{{ extra_params }}"
           hx-target="#{{ target_id }}" hx-swap="innerHTML">{{ p }}</a>
        {% elif p == 3 or p == total_pages - 2 %}
        <span class="page-ellipsis">&hellip;</span>
        {% endif %}
    {% endfor %}

    {% if page < total_pages %}
    <a class="page-link" href="#"
       hx-get="{{ base_url }}?page={{ page + 1 }}{{ extra_params }}"
       hx-target="#{{ target_id }}" hx-swap="innerHTML">&raquo;</a>
    {% endif %}
</nav>
{% endif %}
{% endmacro %}
